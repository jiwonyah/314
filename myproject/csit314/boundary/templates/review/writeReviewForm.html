{% extends 'base.html' %}
{% block content %}
<!--
Users can view a list of registered agents on this page,
and can click the 'Write Review' button next to each agent to navigate to the review writing page.
-->
<div id="agent-list-page">
    <h1>Agent List</h1>
    <table id="agentListTable">
        <thead id="agentListHead">
            <tr id="agentListRow">
            </tr>
        </thead>
        <tbody id="agentList">
            <!-- Agent data should be in here. -->
        </tbody>
    </table>

    <script>
        // Asynchronously request agent data from the /api/agents path
        function fetchAgents() {
            fetch('api/agents')
                // If a successful response is received from the server, dynamically update the page content using response data (JSON object)
                .then(response => response.json())
                .then(data => {
                    const agents = data.agents;
                    const listElement = document.getElementById('agentList');
                    listElement.innerHTML = ''; // empty existing list

                    // create table row with agent data and a button to write a review
                    agents.forEach(agent => {
                        // Combine firstname and lastname into a single full name
                        const fullName = `${agent.firstName} ${agent.lastName}`;

                        const row = `<tr>
                                        <td>
                                            <div class="agentName">${fullName}</div>
                                        </td>
                                        <td><a href="/write-review/${agent.id}" class="review-button">Write Review</a></td>
                                     </tr>`;
                        listElement.innerHTML += row;
                    });
                })
                // Display an error message in the console if the network request fails or an error occurs
                .catch(error => console.error('Error:', error));
        }

        // bring agent data when page loads
        window.onload = function() {
            fetchAgents();
        };
    </script>
</div>
{% endblock %}
